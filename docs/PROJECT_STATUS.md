# 项目进度与协作指南

## 🎯 项目概述

**项目名称**: Fin-News MVP - 金融新闻分析平台  
**目标**: 基于AWS云原生的金融新闻聚合与分析平台，集成RAG管道和LLM  
**时间轴**: 3周MVP开发（8/20-9/9）  
**当前状态**: ✅ **MVP核心功能已完成，准备AWS部署**

## 📊 当前进度 (截至9/1)

### ✅ 已完成
- [x] 项目目录结构搭建
- [x] 技术选型确定
- [x] **RAG检索管线完整实现**：
  - [x] Token-based 文本分块 (TextChunker)
  - [x] 高质量文本嵌入 (TextEmbedder)
  - [x] 生产级索引构建器 (build_index_aws.py)
  - [x] 在线检索服务 (search_api.py)
  - [x] 候选过滤和性能优化
  - [x] AI驱动的摘要和股票卡片生成
  - [x] 完整的系统文档
- [x] **AWS Lambda数据采集模块**：
  - [x] 数据采集Lambda已完成并部署
  - [x] 支持Polygon.io、Reuters RSS、Yahoo Finance
  - [x] 数据已存储到AWS DynamoDB和S3
- [x] **生产就绪配置**：
  - [x] 环境变量模板 (.env.example)
  - [x] AWS配置文件 (aws_config.py)
  - [x] 增量索引构建脚本
  - [x] 性能测试和监控工具

### 🚧 进行中
- [ ] **AWS EC2部署准备**：
  - [ ] 系统服务配置 (systemd)
  - [ ] 安全组和网络配置
  - [ ] 自动化部署脚本
- [ ] **性能基准固化**：
  - [ ] 自动化性能测试
  - [ ] 指标记录和S3存储

### ⏳ 等待中
- [ ] 前端仪表盘开发
- [ ] 生产环境监控和告警
- [ ] CI/CD流水线自动化

## 👥 人员分工

### A（数据采集/检索/价格）
- **负责模块**: ingest, retrieve, pricing
- **技术栈**: 后端 + 数据
- **主要任务**: RSS解析、去重、价格分析
- **状态**: ✅ **数据采集Lambda已完成，数据已存储到AWS**

### B（你 - 处理/建库/RAG/前端）
- **负责模块**: index, rag, api, dashboard
- **技术栈**: 后端 + 应用
- **主要任务**: 分块、向量化、RAG链、前端展示
- **状态**: ✅ **RAG检索管线已完成，AI增强功能已实现，准备部署**

## 🔄 协作流程

### 第一阶段：数据 → 向量库 ✅ 已完成
- ✅ **数据获取**: AWS Lambda + DynamoDB + S3
- ✅ **文本处理**: 分块 + 嵌入 + 清理
- ✅ **索引构建**: 批处理 + 版本管理
- ✅ **在线检索**: FastAPI 服务 + 候选过滤

### 第二阶段：检索 → RAG → 故事 ✅ 已完成
- ✅ **基础检索**: 向量搜索 + 候选过滤
- ✅ **AI摘要**: LLM驱动的摘要生成
- ✅ **股票卡片**: 结构化信息卡片
- ✅ **故事组装**: 事件聚类和故事生成
- ✅ **高级分析**: 趋势分析和影响评估

### 第三阶段：部署 → 监控 → 优化 🔄 进行中
- ✅ **核心功能**: RAG管道和AI服务
- 🔄 **AWS部署**: EC2部署和自动化
- 🔄 **性能监控**: 基准测试和指标记录
- ⏳ **生产运维**: 监控、告警、CI/CD

## 🛠️ 技术架构

### 完整数据流
```
AWS Lambda → DynamoDB → S3 (raw) → 批处理构建器 → S3 (index) → 在线检索服务 → API响应
```

### 核心模块接口
1. **文本分块模块**
   ```python
   from apps.index.chunk import TextChunker
   
   chunker = TextChunker(
       target_tokens=360,
       max_tokens=460,
       overlap_tokens=40,
       min_tokens=200,
       use_blingfire=True
   )
   chunks = chunker.split_text(title, body)
   ```

2. **文本嵌入模块**
   ```python
   from apps.index.embed import TextEmbedder
   
   embedder = TextEmbedder(normalize=True)
   embeddings = embedder.encode(texts)
   ```

3. **在线检索服务**
   ```python
   # FastAPI 服务
   POST /search
   {
     "query": "Apple earnings",
     "tickers": ["AAPL"],
     "published_utc": "2025-08-21T10:00:00Z",
     "top_k": 5
   }
   ```

### 性能指标
- **召回率**: 71% (基础) → 100% (带过滤)
- **搜索延迟**: 0.03-21ms
- **向量质量**: L2 范数 = 1.0000
- **分块质量**: 平均 379-411 tokens

## 📋 立即行动清单

### 已完成的核心功能
- ✅ **RAG检索管线**: 完整的文本分块、嵌入、索引构建和检索服务
- ✅ **生产级部署**: AWS S3 版本化存储和原子部署
- ✅ **性能优化**: 候选过滤、向量缓存、智能回退
- ✅ **质量保证**: 召回测试、性能基准、监控指标
- ✅ **AI增强**: 摘要生成、股票卡片、情感分析
- ✅ **数据采集**: AWS Lambda自动数据采集和存储

### 下一步开发重点
- 🔄 **AWS EC2部署**: 
  - [ ] 系统服务配置 (systemd)
  - [ ] 安全组配置 (8000端口或Nginx代理)
  - [ ] 重启后30秒内恢复
- 🔄 **性能基准固化**:
  - [ ] 运行 `/bench/weak_recall` 并记录指标
  - [ ] 无过滤 ≥0.70 (当前≈0.71)
  - [ ] 有过滤 ≥0.95 (当前=1.00)
  - [ ] 保存 `faiss/metrics/{version}.json` 到S3

### 优化项目
- 🔄 **句分割优化**: 降低句断裂率从 0.56 到 < 0.3
- 🔄 **缓存机制**: 添加 Redis 缓存提升性能
- 🔄 **规模扩展**: 增加数据量和股票覆盖范围

## 🔍 关键文件位置

- **项目根目录**: `/Users/xyl/vscode/fin-news-mvp`
- **核心模块**: `apps/index/`
- **在线服务**: `apps/service/`
- **AWS Lambda**: `aws/lambda/ingest_news_v2/`
- **配置文件**: `conf/`
- **文档**: `docs/`
- **生产脚本**: `scripts/build_index_aws.py`
- **质量检查**: `scripts/sanity_check.py`

## 📞 沟通要点

### 与A需要确认的
1. **数据格式**: ✅ 已确认tickers字段格式一致
2. **接口规范**: ✅ 已明确模块间的调用方式
3. **错误处理**: ✅ 已统一异常处理策略
4. **测试数据**: ✅ 已有测试用的新闻数据

### 技术决策点
1. **向量维度**: ✅ 当前使用384维，性能良好
2. **分块大小**: ✅ 当前300-500 tokens，质量优秀
3. **存储策略**: ✅ FAISS + S3云端存储，生产就绪

## 🚨 风险点

1. ~~**A的数据采集延迟**: 影响整体进度~~ ✅ **已解决**
2. **EC2部署复杂性**: 需要系统级配置
3. **AWS成本控制**: 确保在预算范围内
4. **生产环境稳定性**: 服务重启和故障恢复

## 📈 成功指标

### ✅ 已完成指标
- [x] **RAG检索管线**: 完整的文本分块、嵌入、索引构建和检索服务
- [x] **召回率**: 71% (基础) → 100% (带过滤)
- [x] **搜索延迟**: 0.03-21ms (非常快)
- [x] **向量质量**: L2 范数 = 1.0000 (完美)
- [x] **分块质量**: 平均 379-411 tokens (目标范围)
- [x] **AI功能**: 摘要生成、股票卡片、情感分析
- [x] **数据采集**: AWS Lambda自动数据采集和存储

### 🔄 进行中指标
- [ ] **EC2部署**: 服务启动和健康检查
- [ ] **性能基准**: 自动化测试和指标记录
- [ ] **生产监控**: 服务状态和性能监控

### 📋 待完成指标
- [ ] **前端界面**: 可筛选、可展开详情
- [ ] **生产监控**: 告警和运维监控
- [ ] **定时任务**: 每日CRON成功运行
- [ ] **CI/CD**: GitHub Actions自动化部署

---

**最后更新**: 2025-09-01  
**更新人**: B（你）  
**下次更新**: 完成EC2部署和性能基准固化后
